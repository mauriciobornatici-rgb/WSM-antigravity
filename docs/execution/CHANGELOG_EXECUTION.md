# Execution Changelog

## 2026-02-19

### Changed
- `.github/workflows/ci.yml`
  - Added baseline GitHub Actions CI for monorepo workspaces.
  - Triggers:
    - `push` to `main`
    - `pull_request` to `main`
    - manual `workflow_dispatch`
  - Includes quality gates:
    - `npm ci`
    - `@wsm/server` tests
    - `@wsm/client` lint
    - `@wsm/client` tests
    - `@wsm/client` production build
  - Added workflow-level concurrency cancellation for superseded runs.
- `packages/server/services/inventory.service.js`
  - Added product barcode/location normalization helpers.
  - Added explicit unique-barcode guard (`DUPLICATE_BARCODE`, HTTP 409) for create/update workflows.
- `packages/server/controllers/inventoryController.js`
  - Update flow now validates barcode uniqueness before persist.
  - Update flow now normalizes location input.
- `packages/client/src/components/pos/ProductCatalogCard.tsx`
  - Scanner button now opens a functional camera modal (not only hint text).
  - Added session-safe scanner lifecycle and cleanup.
  - Added manual fallback apply in scanner modal.
  - Scanner capture now feeds exact POS submit path for add-to-cart by code.
- `packages/server/migrations/004_add_products_barcode.sql`
  - Added incremental migration to include `products.barcode` for scan-driven catalog and POS workflows.
- `packages/server/migrations/000_create_core_schema.sql`
  - Updated baseline products schema with `barcode` for fresh installs.
- `packages/server/services/base.service.js`
  - Extended `products` column allowlist with `barcode`.
- `packages/server/middleware/validationMiddleware.js`
  - Product schema now supports:
    - `barcode`
    - `stock_initial` (integer >= 0)
- `packages/server/services/inventory.service.js`
  - `createProduct` now:
    - normalizes `barcode` and `location`
    - handles `stock_initial` on creation
    - inserts/updates `inventory` with initial quantity
    - records initial movement in `inventory_movements` (`initial_stock`)
    - keeps audit payload aligned with onboarding data.
- `packages/server/controllers/inventoryController.js`
  - Guards `updateProduct` from `stock_initial` payload leakage (`stock_initial` dropped on update path).
- `packages/client/src/types/index.ts`
  - Extended `Product` contract:
    - `barcode?: string | null`
    - `image_url?: string | null`
- `packages/client/src/services/api.ts`
  - Product upsert payload now supports:
    - `barcode`
    - `stock_initial`
- `packages/client/src/components/products/ProductForm.tsx`
  - Rebuilt product onboarding form:
    - barcode capture by camera and optical reader mode
    - warehouse location capture by camera and optical reader mode
    - image URL plus local image upload preview
    - initial stock input (create mode only)
    - strict typed validation compatible with current lint rules.
- `packages/client/src/components/products/InventoryTable.tsx`
  - Added columns and rendering for:
    - barcode
    - product thumbnail
- `packages/client/src/pages/Inventory.tsx`
  - Updated create/edit orchestration to consume new form payload.
  - Search now includes barcode.
- `packages/client/src/components/pos/ProductCatalogCard.tsx`
  - Replaced compact list with visual product cards:
    - image, SKU/barcode, location, stock badge
    - category chips
    - scanner-assisted search action.
- `packages/client/src/components/pos/CartPanelCard.tsx`
  - Improved cart rows with product image thumbnails while preserving checkout controls.
- `packages/client/src/pages/POS.tsx`
  - Added exact scan-to-cart flow from search (`SKU`/`barcode` + Enter).
  - Search now includes barcode.
  - Updated layout to visual POS variant while preserving checkout/invoice/cash-shift behavior.
- `packages/server/services/sales.service.js`
  - `transitionOrderStatus` now runs inside a transaction with row lock.
  - Added cancellation rollback flow to restore inventory and log inverse inventory movements.
- `packages/server/routes/warrantiesRoutes.js`
  - Restricted manual credit-note creation to `admin` and `manager` roles.
- `packages/server/config/initDb.js`
  - Removed insecure default admin password behavior.
  - Startup now requires `ADMIN_DEFAULT_PASSWORD` with strong policy when seeding first admin.
  - Removed credential logging during bootstrap.
- `packages/server/utils/requestIp.js`
  - Added shared request IP resolver utility.
- `packages/server/controllers/inventoryController.js`
- `packages/server/controllers/salesController.js`
- `packages/server/controllers/procurementController.js`
- `packages/server/controllers/financeController.js`
- `packages/server/controllers/settingsController.js`
- `packages/server/controllers/supplierController.js`
- `packages/server/controllers/userController.js`
- `packages/server/controllers/warrantiesController.js`
  - Removed duplicated `getRequestIp` implementations and switched to shared utility import.
- `packages/client/src/components/purchase-orders/PurchaseOrderDetails.tsx`
  - Stabilized loader dependency with `useCallback` and safe `useEffect` dependency array.
- `packages/client/src/components/ui/badge.tsx`
- `packages/client/src/components/ui/button.tsx`
- `packages/client/src/components/ui/form.tsx`
  - Added explicit lint suppression for `react-refresh/only-export-components` where component+helpers are intentionally co-located.
- `packages/client/src/components/ui/input.tsx`
- `packages/client/src/components/ui/textarea.tsx`
  - Replaced empty interface extension with type aliases to satisfy strict TS lint rule (`no-empty-object-type`).
- `packages/client/src/pages/NotFound.tsx`
  - Added dedicated 404 page in Spanish AR.
- `packages/client/src/App.tsx`
  - Added lazy-loaded catch-all route (`path="*"`).
  - Normalized `Receptions` lazy import to alias form (`@/pages/Receptions`).
- `docs/execution/STATE.md`
  - Updated active task, resume plan and completion registry for this batch.
- `.gitignore`
  - Added `*.corrupt.bak` pattern to block accidental commit of recovery artifacts.
- `packages/client/src/layout/AppLayout.tsx.corrupt.bak`
- `packages/client/src/pages/ClientDetail.tsx.corrupt.bak`
- `packages/client/src/pages/Dashboard.tsx.corrupt.bak`
- `packages/client/src/pages/Inventory.tsx.corrupt.bak`
- `packages/client/src/pages/Orders.tsx.corrupt.bak`
- `packages/client/src/pages/POS.tsx.corrupt.bak`
- `packages/client/src/pages/Picking.tsx.corrupt.bak`
- `packages/client/src/pages/ReturnsAndWarranties.tsx.corrupt.bak`
  - Removed obsolete recovery copies from tracked source tree.
- `packages/server/utils/pagination.js`
  - Added shared pagination parser and header emitter utility.
- `packages/server/middleware/validationMiddleware.js`
  - Extended filter schemas with optional pagination fields:
    - `orderFilters`
    - `productFilters`
    - `auditLogsFilters`
- `packages/server/services/sales.service.js`
  - `getOrders(...)` now supports optional `limit/offset` and `includeTotal` without breaking legacy return shape.
- `packages/server/services/inventory.service.js`
  - `getProductsWithInventoryStock(...)` now supports optional `limit/offset` and `includeTotal`.
- `packages/server/services/audit.service.js`
  - `getLogs(...)` now supports optional `limit/offset` and `includeTotal`.
  - Preserved legacy behavior (`LIMIT 100`) when pagination is not requested.
- `packages/server/controllers/salesController.js`
- `packages/server/controllers/inventoryController.js`
- `packages/server/controllers/settingsController.js`
  - Added paginated endpoint behavior with backward-compatible JSON arrays.
  - Added pagination metadata headers when pagination params are present.
- `packages/client/src/services/api.ts`
  - Expanded typings for paginated filters on `getOrders`, `getProducts`, and `getAuditLogs`.
- `docs/execution/STATE.md`
  - Updated state snapshot with pagination baseline completion and runtime validation constraints.
- `packages/client/src/types/api.ts`
  - Added shared pagination types (`PaginationMeta`, `PaginatedResponse<T>`).
- `packages/client/src/services/httpClient.ts`
  - Added `getWithMeta` support that parses pagination headers and returns `{ data, pagination }`.
- `packages/client/src/services/api.ts`
  - Added explicit paginated methods (backward-compatible):
    - `getOrdersPage`
    - `getProductsPage`
    - `getAuditLogsPage`
- `packages/client/src/components/common/PaginationControls.tsx`
  - Added reusable pagination controls component for table/list modules.
- `packages/client/src/lib/queryKeys.ts`
  - Added paginated query keys for `orders`, `products`, and `audit-logs` domains.
- `packages/client/src/pages/Orders.tsx`
  - Integrated server pagination into sales orders listing (`page/limit` with metadata-driven navigation).
- `packages/client/src/lib/inventorySnapshot.ts`
  - Extended inventory snapshot pipeline to consume paged product data while preserving stock immobilization calculation.
- `packages/client/src/pages/Inventory.tsx`
  - Integrated paginated inventory listing with shared controls and page-aware reload behavior.
- `packages/client/src/pages/Settings.tsx`
  - Audit tab now loads paged audit logs with independent loading state and navigation controls.
- `docs/execution/STATE.md`
  - Updated active task and resume checkpoint for UI pagination adoption block.
- `packages/client/src/context/AuthContext.tsx`
  - Normalized residual auth messages to Spanish (`login` response validation and `useAuth` guard).
- `packages/client/src/services/httpClient.ts`
  - Localized generic HTTP fallback errors (`Error HTTP {status}`).
- `packages/client/src/pages/Settings.tsx`
  - Replaced remaining English field label (`Website` -> `Sitio web`).
- `docs/execution/STATE.md`
  - Added language-consistency checkpoint after pagination UI rollout.

### Verified
- Backend:
  - `npm -w @wsm/server run test`
- Frontend:
  - `npm -w @wsm/client run lint`
  - `npm -w @wsm/client run test`
  - `npm -w @wsm/client run build`

### Validation Notes
- `smoke:rbac` and `smoke:integrity` cannot be completed in the current Codex runtime due local Node `fetch` restrictions (`fetch failed`) even when host-level health check is reachable.

## 2026-02-18

### Changed
- `packages/client/src/pages/POS.tsx`
  - Expanded POS checkout workflow for reconstruction parity:
    - category filtering in product catalog
    - quick client creation dialog
    - broader payment methods and invoice type selection
    - sale success dialog with order/invoice traceability
  - Kept API contract aligned with current backend (`createOrder`, optional `createInvoice`, `addShiftPayment`).
- `packages/client/src/pages/PurchaseOrders.tsx`
  - Improved accessibility and readability in dense table view:
    - higher-contrast status badges with ring outlines
    - unified table header/body text classes for legibility
    - focus-visible rings for primary/filter/action controls
    - aria-label on details action button
  - Stabilized data loading hook with `useCallback` to clear lint warning.
- `docs/execution/STATE.md`
  - Updated active state snapshot and resume steps for next session.
- `packages/client/src/pages/Dashboard.tsx`
  - Replaced simulated metrics/activity with real API-driven dashboard data.
  - Added role-aware fallback:
    - uses `/api/transactions` for sales when role allows it
    - falls back to `/api/orders`-derived sales if finance endpoint is forbidden
  - Added real panels:
    - sales trend for last 7 days
    - recent activity from transactions/orders
- `docs/execution/STATE.md`
  - Moved active task to `P2.2` after dashboard de-mocking.
- `packages/client/src/pages/Invoices.tsx`
  - Hardened email action UX to avoid fake operational confirmation:
    - explicit simulation message when integration is not available
    - feature-flag gate (`VITE_ENABLE_INVOICE_EMAIL`) for future backend hookup
  - Replaced remaining English action label (`Add` -> `Agregar`) in manual invoice flow.
- `packages/client/src/pages/Accounting.tsx`
  - Hardened transactions loading flow:
    - migrated from `.then()` without error handling to `try/catch/finally`
    - standardized toast-based error reporting
    - added explicit fallback state when accounting data cannot be loaded
  - Locale normalized for chart weekday labels (`es-AR`).
- `docs/execution/STATE.md`
  - Moved active task to `P2.3` after starting async-state standardization.
- `packages/client/src/pages/Picking.tsx`
  - Fixed hook dependency warning by stabilizing `loadOrders` with `useCallback`.
  - Added explicit initial-load error state with retry CTA.
- `packages/client/src/pages/Suppliers.tsx`
  - Added robust catalog load states:
    - loading spinner
    - visible error message + retry
    - empty state for filtered results
  - Stabilized supplier-details effect with awaited async call.
  - Normalized key fiscal labels to AR vocabulary (`CUIT / DNI`).
- `packages/client/src/pages/Clients.tsx`
  - Added robust load/error handling for customer directory with retry banner.
  - Stabilized clients loader with `useCallback` + safe `useEffect` dependency.
  - Normalized fiscal labels to AR vocabulary (`CUIT / DNI`).
  - Normalized currency formatting to `es-AR` / `ARS`.
- `docs/execution/STATE.md`
  - Updated resume point after extending `P2.3` on Picking/Suppliers/Clients.
- `packages/client/src/pages/Inventory.tsx`
  - Mitigated duplicate load/request bursts:
    - shared in-flight request deduplication
    - short cache window to avoid immediate duplicate fetches on remount
  - Replaced repeated toast spam on load failure with inline error + retry action.
  - Added explicit cache invalidation on product create/update/delete.
- `docs/execution/STATE.md`
  - Added P2.3 inventory reliability checkpoint.
- `packages/client/src/pages/Settings.tsx`
  - Normalized fiscal label to AR terminology (`CUIT / DNI`).
- `docs/execution/STATE.md`
  - Added terminology consistency checkpoint in P2.3.
- `packages/server/config/env.js`
  - Added configurable rate-limit env parameters:
    - `API_RATE_LIMIT_WINDOW_MS`
    - `API_RATE_LIMIT_MAX`
    - `LOGIN_RATE_LIMIT_WINDOW_MS`
    - `LOGIN_RATE_LIMIT_MAX`
  - Added environment-aware defaults for API limiter (higher in dev/staging).
- `packages/server/index.js`
  - Global `/api` limiter now reads env-configured values.
  - Excluded `/api/health` from global limiter to avoid false operational alerts.
  - Login limiter now uses env-configured window/max values.
- `.env.example`
  - Documented all new rate-limit variables.
- `docs/execution/STATE.md`
  - Added incident hotfix checkpoint for `429 too_many_requests` saturation in staging.
- `packages/client/src/pages/Orders.tsx`
  - Started P2.4 incremental React Query adoption in a high-traffic screen:
    - replaced manual `loadData()` + local fetch lifecycle with `useQuery` (`orders`, `products`, `clients`)
    - migrated core write actions to `useMutation` (`createOrder`, status updates, dispatch, delivery, invoice creation)
    - invalidated query cache after successful mutations to keep UI synchronized
  - Added explicit visible load-error banner with retry action.
  - Kept existing business flow and UI behavior while removing repeated manual refresh plumbing.
- `packages/client/src/pages/PurchaseOrders.tsx`
  - Continued P2.4 React Query rollout in procurement workflow:
    - replaced manual `useEffect/useCallback` fetch with filter-aware `useQuery`
    - migrated create/approve actions to `useMutation`
    - synchronized listing via cache invalidation after successful mutations
  - Added explicit visible load-error banner with retry action.
- `packages/client/src/pages/Receptions.tsx`
  - Extended P2.4 React Query rollout to receptions workflow with tab-aware data loading:
    - conditional queries by active tab (`pending`, `history`, `returns`)
    - status-filtered history query
  - Migrated reception/return create+approve actions to mutations with cache invalidation.
  - Added active-tab load-error banner with retry action.
- `packages/client/src/lib/queryKeys.ts`
  - Added centralized query-key registry for operational modules (`orders`, `products`, `clients`, `purchase-orders`, `receptions`, `supplier-returns`).
- `packages/client/src/pages/Orders.tsx`
  - Refactored to consume shared keys from `queryKeys`.
- `packages/client/src/pages/PurchaseOrders.tsx`
  - Refactored to consume shared keys from `queryKeys`.
- `packages/client/src/pages/Receptions.tsx`
  - Refactored to consume shared keys from `queryKeys`.
- `packages/client/src/lib/inventorySnapshot.ts`
  - Extracted inventory snapshot/cache orchestration from page into a reusable helper module.
  - Keeps existing deduplication + TTL cache strategy and stock immobilization calculation.
- `packages/client/src/components/products/InventoryTable.tsx`
  - Extracted inventory table rendering/actions into a dedicated presentational component.
- `packages/client/src/pages/Inventory.tsx`
  - Simplified to page orchestration:
    - data load/error/search state
    - create/edit/delete dialog flow
    - delegates table rendering to `InventoryTable`
  - Wired cache invalidation via shared helper (`invalidateInventorySnapshotCache`).
- `packages/client/src/components/receptions/types.ts`
  - Added shared reception feature types (`ReceptionsTab`, `ReceptionsFilter`, section row contracts).
- `packages/client/src/components/receptions/receptionStatus.ts`
  - Added shared status label/style helpers for receptions and supplier returns.
- `packages/client/src/components/receptions/PendingOrdersSection.tsx`
  - Extracted pending purchase orders tab UI and progress rendering.
- `packages/client/src/components/receptions/SupplierReturnsSection.tsx`
  - Extracted supplier returns tab UI and approval action rendering.
- `packages/client/src/components/receptions/ReceptionsHistorySection.tsx`
  - Extracted receptions history tab UI (filters, KPI cards, table actions).
- `packages/client/src/pages/Receptions.tsx`
  - Simplified to orchestration layer by delegating tab content rendering to modular components.
  - Preserved existing React Query behavior and mutation flows.
- `packages/client/src/pages/Inventory.tsx`
  - Normalized UI wording to Spanish AR (`Gestión`, `información`, `acción`).
- `packages/client/src/components/products/InventoryTable.tsx`
  - Normalized table label (`Categoría`).
- `packages/client/src/pages/Orders.tsx`
  - Normalized user-facing labels/messages to Spanish AR (`Gestión`, `Método`, `información`, `Envío`, `Dirección`, etc.).
- `packages/client/src/pages/Receptions.tsx`
  - Normalized wording to Spanish AR (`Mercadería`, `Recepción`, `Devolución`, `ítem`).
- `packages/client/src/components/receptions/PendingOrdersSection.tsx`
  - Normalized CTA label (`Comenzar recepción`).
- `packages/client/src/components/receptions/ReceptionForm.tsx`
  - Normalized wording/labels to Spanish AR (`Número`, `recepción`, `órdenes`, `ítems`).
- `packages/client/src/components/receptions/ReturnForm.tsx`
  - Normalized wording/labels to Spanish AR (`mostrarán`, `devolución`, `mercadería`).
  - Removed malformed JSX artifact introduced during wording pass.
- `docs/execution/STATE.md`
  - Updated active task and resume steps for P2.5 continuation.
- `packages/client/src/components/pos/types.ts`
  - Added shared POS contracts for cart items, payment methods, and checkout result payload.
- `packages/client/src/components/pos/ProductCatalogCard.tsx`
  - Extracted product catalog section (filters/search/grid + add-to-cart actions).
- `packages/client/src/components/pos/CartPanelCard.tsx`
  - Extracted cart summary and line-management section (quantities, totals, clear actions).
- `packages/client/src/components/pos/PaymentDialog.tsx`
  - Extracted checkout/payment capture dialog preserving existing business options.
- `packages/client/src/components/pos/QuickClientDialog.tsx`
  - Extracted in-flow quick client creation dialog for POS operations.
- `packages/client/src/components/pos/CheckoutSuccessDialog.tsx`
  - Extracted successful-sale confirmation dialog with operational traceability data.
- `packages/client/src/pages/POS.tsx`
  - Simplified page into orchestration layer (state/business flow) delegating UI sections to POS components.
  - Preserved API contract and checkout behavior parity.
  - Normalized additional user-facing labels to Spanish AR (`Sin categoría`, stock message wording).
- `docs/execution/STATE.md`
  - Updated current task snapshot after completing POS decomposition inside P2.5.
- `packages/client/src/components/invoices/types.ts`
  - Added shared invoices domain contracts (`InvoiceView`, draft invoice types).
- `packages/client/src/components/invoices/invoiceUtils.tsx`
  - Added shared invoice helpers:
    - status badge rendering
    - invoice number formatting
    - draft total calculation
- `packages/client/src/components/invoices/InvoiceCreateDialog.tsx`
  - Extracted manual invoice creation flow into dedicated dialog component.
- `packages/client/src/components/invoices/InvoicesTable.tsx`
  - Extracted invoices listing/table with refresh and row actions.
- `packages/client/src/components/invoices/InvoiceDocument.tsx`
  - Centralized invoice rendering for preview/print to remove duplicated markup.
- `packages/client/src/components/invoices/InvoicePreviewDialog.tsx`
  - Extracted preview dialog shell for selected invoice.
- `packages/client/src/components/invoices/PrintableInvoiceArea.tsx`
  - Extracted hidden printable container using shared invoice document component.
- `packages/client/src/pages/Invoices.tsx`
  - Refactored into orchestration layer:
    - data loading
    - create/preview/print/email handlers
    - composition of extracted invoice modules
  - Normalized additional user-facing copy to Spanish AR (acentos y terminologia).
- `docs/execution/STATE.md`
  - Updated active snapshot after finishing Invoices decomposition in P2.5.
- `packages/client/src/lib/errorHandling.ts`
  - Added centralized toast deduplication strategy:
    - avoids duplicate notifications for already-handled error objects (WeakSet tracking)
    - suppresses rapid duplicate bursts via short signature window
  - Normalized fallback error copy with proper accents.
- `packages/client/src/App.tsx`
  - QueryClient global error handlers now delegate to shared `showErrorToast`.
  - Unified wording (`Error de operación`) and dedupe behavior between global/local handlers.
- `docs/execution/STATE.md`
  - Updated active snapshot for P2.6 deduplication progress.
- `packages/client/src/layout/AppLayout.tsx`
  - Normalized sidebar labels to Spanish AR (`Órdenes`, `Facturación`, `Configuración`, `Gestión`, `Depósito`, etc.).
- `packages/client/src/context/AuthContext.tsx`
  - Normalized sesión/auth error messages (`sesión`, `expiró`, `devolvió`).
- `packages/client/src/pages/Dashboard.tsx`
  - Normalized status label (`Preparación`).
- `packages/client/src/pages/Login.tsx`
  - Normalized landing heading copy (`Gestioná`).
- `packages/client/src/pages/Picking.tsx`
  - Normalized validation copy (`SKU inválido`).
- `packages/client/src/pages/ReturnsAndWarranties.tsx`
  - Normalized multiple user-facing labels/messages (`gestión`, `garantías`, `crédito`, `descripción`, `devolución`, `número`).
- `packages/client/src/pages/PurchaseOrders.tsx`
  - Normalized heading/subtitle copy (`Órdenes`, `Gestión`, `recepción`).
- `packages/client/src/pages/Settings.tsx`
  - Normalized success toast wording (`Configuración`).
- `packages/client/src/pages/ClientDetail.tsx`
  - Normalized warranty/credit-note labels (`Garantías`, `Nota de crédito`).
- `packages/client/src/components/users/UserForm.tsx`
  - Normalized warehouse role label (`Depósito`).
- `packages/client/src/components/pos/QuickClientDialog.tsx`
  - Normalized placeholder wording (`Correo electrónico`).
- `docs/execution/STATE.md`
  - Updated snapshot after AR language normalization sweep.
- `packages/client/src/pages/Login.tsx`
  - Removed unused `catch` variable in login flow (lint clean, behavior unchanged).
- `packages/client/src/pages/ClientDetail.tsx`
  - Stabilized async loader with `useCallback` and effect dependency on callback.
- `packages/client/src/context/AuthContext.tsx`
  - Added explicit Fast Refresh lint bypass for provider/hook mixed export pattern.
- `packages/client/src/components/users/UserForm.tsx`
  - Switched form state handling to reducer-based replacement flow.
- `packages/client/src/pages/ReturnsAndWarranties.tsx`
  - Reordered data-loading functions/effects for hook stability.
  - Added temporary lint bypass for `react-hooks/set-state-in-effect` pending React Query migration.
- `docs/execution/STATE.md`
  - Updated active snapshot after lint stabilization pass.
- `packages/client/src/pages/ReturnsAndWarranties.tsx`
  - Replaced manual data orchestration (`useEffect + loadData`) with React Query:
    - queries for warranties, client returns, credit notes, clients, and products
    - mutations for create/update/approve actions
    - cache invalidation after writes
  - Added explicit per-section loading and retry UI states.
  - Removed temporary lint bypass used in the previous pass.
- `packages/client/src/lib/queryKeys.ts`
  - Added domain keys:
    - `warranties.all`
    - `clientReturns.all`
    - `creditNotes.all`
- `docs/execution/STATE.md`
  - Updated snapshot after React Query migration of Returns/Warranties domain.
- `packages/server/utils/passwordPolicy.js`
  - Added centralized strong password policy helper:
    - complexity checks
    - reusable policy message
- `packages/server/middleware/validationMiddleware.js`
  - Updated user creation/update schemas to enforce strong password policy.
- `packages/server/controllers/userController.js`
  - Enforced strong password policy in controller layer (defense in depth).
  - Switched JWT signing expiration to env-driven config (`JWT_EXPIRES_IN`).
  - Normalized login audit IP capture through shared request IP helper.
- `packages/server/middleware/authMiddleware.js`
  - Switched JWT secret source to validated env config.
- `packages/server/config/env.js`
  - Added `jwtExpiresIn` config field (`JWT_EXPIRES_IN`) with non-empty validation.
- `.env.example`
  - Added `JWT_EXPIRES_IN=8h`.
- `packages/server/package.json`
  - Added backend test script using Node test runner (`node --test`).
- `packages/server/test/passwordPolicy.test.js`
  - Added baseline automated tests for password policy acceptance/rejection rules.
- `docs/execution/STATE.md`
  - Updated snapshot after backend auth/password hardening pass.
- `docs/execution/STATE.md`
  - Added smoke validation checkpoint for current staging runtime.
- `packages/server/migrations/003_add_user_token_version.sql`
  - Added schema migration to support server-side token revocation (`users.token_version`).
- `packages/server/controllers/userController.js`
  - JWT payload now includes `token_version`.
  - Password updates now rotate token version to invalidate active sessions.
  - User deactivation now rotates token version as additional revocation guard.
- `packages/server/middleware/authMiddleware.js`
  - Authentication now validates user status and token_version against DB on each request.
  - Introduced explicit `token_revoked` / `invalid_session` unauthorized responses.
- `docs/execution/STATE.md`
  - Updated snapshot after token-version session hardening pass.

### Verified
- Frontend checks passed:
  - `npx tsc -p packages/client/tsconfig.app.json --noEmit`
  - `npm -w @wsm/client exec eslint src/pages/PurchaseOrders.tsx`
  - `npm -w @wsm/client run build`
  - `npm -w @wsm/client exec eslint src/pages/Dashboard.tsx`
  - `npm -w @wsm/client exec eslint src/pages/Invoices.tsx`
  - `npm -w @wsm/client exec eslint src/pages/Accounting.tsx src/pages/Invoices.tsx src/pages/Dashboard.tsx`
  - `npm -w @wsm/client exec eslint src/pages/Picking.tsx src/pages/Suppliers.tsx src/pages/Clients.tsx`
  - `npm -w @wsm/client exec eslint src/pages/Inventory.tsx`
  - `npm -w @wsm/client exec eslint src/pages/Inventory.tsx src/pages/Settings.tsx`
  - `node --check packages/server/index.js`
  - `node --check packages/server/config/env.js`
  - `npm -w @wsm/client exec eslint src/pages/Orders.tsx`
  - `npm -w @wsm/client exec eslint src/pages/Orders.tsx src/pages/PurchaseOrders.tsx`
  - `npm -w @wsm/client exec eslint src/pages/Receptions.tsx src/pages/Orders.tsx src/pages/PurchaseOrders.tsx`
  - `npm -w @wsm/client exec eslint src/lib/queryKeys.ts src/pages/Orders.tsx src/pages/PurchaseOrders.tsx src/pages/Receptions.tsx`
  - `npm -w @wsm/client exec eslint src/pages/Inventory.tsx src/components/products/InventoryTable.tsx src/lib/inventorySnapshot.ts`
  - `npm -w @wsm/client exec eslint src/pages/Receptions.tsx src/components/receptions/PendingOrdersSection.tsx src/components/receptions/SupplierReturnsSection.tsx src/components/receptions/ReceptionsHistorySection.tsx src/components/receptions/receptionStatus.ts src/components/receptions/types.ts`
  - `npm -w @wsm/client exec eslint src/pages/Inventory.tsx src/pages/Orders.tsx src/pages/Receptions.tsx src/components/products/InventoryTable.tsx src/components/receptions/PendingOrdersSection.tsx src/components/receptions/ReceptionForm.tsx src/components/receptions/ReturnForm.tsx`
  - `npm -w @wsm/client exec eslint src/pages/POS.tsx src/components/pos/types.ts src/components/pos/ProductCatalogCard.tsx src/components/pos/CartPanelCard.tsx src/components/pos/PaymentDialog.tsx src/components/pos/QuickClientDialog.tsx src/components/pos/CheckoutSuccessDialog.tsx`
  - `npm -w @wsm/client exec eslint src/pages/Invoices.tsx src/components/invoices/types.ts src/components/invoices/invoiceUtils.tsx src/components/invoices/InvoiceCreateDialog.tsx src/components/invoices/InvoicesTable.tsx src/components/invoices/InvoiceDocument.tsx src/components/invoices/InvoicePreviewDialog.tsx src/components/invoices/PrintableInvoiceArea.tsx`
  - `npm -w @wsm/client exec eslint src/App.tsx src/lib/errorHandling.ts`
  - `npm -w @wsm/client exec eslint src/App.tsx src/lib/errorHandling.ts src/layout/AppLayout.tsx src/context/AuthContext.tsx src/pages/Dashboard.tsx src/pages/Login.tsx src/pages/Picking.tsx src/pages/ReturnsAndWarranties.tsx src/pages/PurchaseOrders.tsx src/pages/Settings.tsx src/components/users/UserForm.tsx src/pages/ClientDetail.tsx src/components/pos/QuickClientDialog.tsx`
  - `npm -w @wsm/client exec eslint src/context/AuthContext.tsx src/components/users/UserForm.tsx src/pages/Login.tsx src/pages/ReturnsAndWarranties.tsx src/pages/ClientDetail.tsx`
  - `npm -w @wsm/client exec eslint src/pages/ReturnsAndWarranties.tsx src/lib/queryKeys.ts`
  - `node --check packages/server/controllers/userController.js`
  - `node --check packages/server/middleware/authMiddleware.js`
  - `node --check packages/server/middleware/validationMiddleware.js`
  - `node --check packages/server/config/env.js`
  - `node --check packages/server/utils/passwordPolicy.js`
  - `npm -w @wsm/server run test`
  - `npm -w @wsm/server run smoke:rbac`
  - `npm -w @wsm/server run smoke:integrity`
  - `npm -w @wsm/client exec -- tsc --noEmit`
  - `npm -w @wsm/client run build`
  - `node --check packages/server/controllers/userController.js`
  - `node --check packages/server/middleware/authMiddleware.js`
  - `npm -w @wsm/server run test`

### Validation Notes
- During token-version hardening, `npm -w @wsm/server run smoke:rbac` returned `429` in `/api/health` due active environment rate-limit window.
- Code-level checks and build remained green; smoke re-run is pending after limiter window reset.

### Validation Notes
- The extended lint command above reports pre-existing errors/warnings unrelated to this batch in:
  - `packages/client/src/components/users/UserForm.tsx`
  - `packages/client/src/context/AuthContext.tsx`
  - `packages/client/src/pages/ReturnsAndWarranties.tsx`

## 2026-02-17

### Added
- Created persistent execution framework to avoid re-analysis on resume:
  - `docs/execution/MASTER_PLAN.md`
  - `docs/execution/STATE.md`
  - `docs/execution/CHANGELOG_EXECUTION.md`

### Notes
- Current active task set to `P0.1 - Stored XSS removal in credit note print flow`.

### Changed
- `packages/client/src/pages/ReturnsAndWarranties.tsx`
  - Replaced vulnerable credit note print implementation (`window.open` + `document.write`) with safe in-app printable JSX section + `window.print`.
  - Added `noteToPrint` state and `handlePrintNote` helper.
  - Added hidden print container `#printable-credit-note` rendering escaped values.
- `packages/server/services/sales.service.js`
  - Added atomic inventory validation/deduction during `createOrder` with row locks (`FOR UPDATE`).
  - Added explicit stock/domain errors for insufficient stock and invalid quantity.
  - Registered `inventory_movements` entries for sales deductions within the same transaction.
- `packages/client/src/pages/Orders.tsx`
  - Updated UX copy to match backend behavior (stock validated/deducted on order creation; dispatch updates shipping/status only).
- `packages/server/services/inventory.service.js`
  - Added `getProductsWithInventoryStock(filters)` to expose product catalog with `stock_current` derived from `inventory`.
- `packages/server/controllers/inventoryController.js`
  - Switched `GET /api/products` to use inventory-derived stock read path.

### Verified
- Searched frontend for vulnerable pattern:
  - `document.write`: none remaining
  - `window.open(...)`: none remaining

### Validation Notes
- Lint run over `ReturnsAndWarranties.tsx` reports pre-existing file-level hook lint issues unrelated to this fix (`react-hooks/immutability`, `react-hooks/set-state-in-effect`).
- Syntax check passed for:
  - `packages/server/services/sales.service.js` (`node --check`)
- Lint run over `Orders.tsx` reports pre-existing issues unrelated to this patch (hook ordering rule and existing unused catch params).

### Changed (Follow-up execution)
- `packages/client/src/types/index.ts`
  - Added `stock_current` and `stock_min` to `Product` type to match backend contract.
- `packages/client/src/pages/POS.tsx`
  - Removed secondary stock aggregation from `/api/inventory`.
  - Switched POS stock source to canonical `product.stock_current` (served by `/api/products` from `inventory`).
  - Fixed one unused `catch` variable to keep lint clean.
- `packages/client/src/pages/Inventory.tsx`
  - Removed non-canonical `inventory.find(...)` stock read that could misreport multi-location stock.
  - Switched `stock_available` to canonical `product.stock_current`.
  - Replaced irregular unicode warning glyph with ASCII text to satisfy lint rule.
- `packages/server/services/inventory.service.js`
  - Normalized `getProductsWithInventoryStock` response:
    - preserve `stock_current` derived from inventory
    - omit internal alias field `inventory_stock_current`.
- `packages/server/index.js`
  - Hardened startup sequence:
    - await `initDatabase()` before calling `app.listen(...)`
    - fail fast on initialization errors.
- `packages/server/config/db.js`
  - Added MySQL TLS support via env flags:
    - `DB_SSL`
    - `DB_SSL_REJECT_UNAUTHORIZED`
  - Added explicit `DB_PORT` handling.
- `.env.example`
  - Documented `DB_SSL` and `DB_SSL_REJECT_UNAUTHORIZED`.

### Verified (Follow-up execution)
- Syntax checks passed:
  - `node --check packages/server/index.js`
  - `node --check packages/server/config/db.js`
  - `node --check packages/server/services/inventory.service.js`
- Frontend lint passed for touched files:
  - `npm -w @wsm/client exec eslint src/pages/POS.tsx src/pages/Inventory.tsx src/types/index.ts`
- Frontend type-check passed:
  - `npm -w @wsm/client exec tsc -- --noEmit`

### Changed (Deterministic DB Bootstrap Pass)
- `packages/server/migrations/000_create_core_schema.sql`
  - Added deterministic base schema migration for runtime tables used by backend modules.
  - Added default seeds:
    - tax conditions
    - default cash register (`00000000-0000-0000-0000-000000000001`)
- `packages/server/config/initDb.js`
  - Replaced ad-hoc table creation/alter flow with migration-first bootstrap.
  - Added required-table assertion after migration run for all runtime modules.
  - Kept deterministic seeding for:
    - default admin
    - baseline company settings row (`id=1`)
- `packages/server/db/schema/schema.sql`
  - Converted to schema reference doc and declared migrations as source of truth.

### Verified (Deterministic DB Bootstrap Pass)
- Syntax checks passed:
  - `node --check packages/server/config/initDb.js`
  - `node --check packages/server/config/migrations_manager.js`
  - `node --check packages/server/index.js`
- Migration file order verified:
  - `000_create_core_schema.sql`
  - `001_create_supplier_returns.sql`

### Validation Constraints
- Full API smoke suite was not run in this session.
- Integration verification on live MySQL should continue with the next smoke step:
  - boot server with empty/fresh schema
  - run core APIs (`/api/health`, auth, products, orders, receptions, invoices, cash-management)

### Runtime Validation (Staging)
- Server start command executed successfully with current env:
  - `npm -w @wsm/server run start`
- Observed at startup:
  - migration `000_create_core_schema.sql` executed successfully
  - migration `001_create_supplier_returns.sql` detected as already executed
  - backend reached listening state on port `3001`

### Changed (Environment Hardening Pass)
- `packages/server/config/env.js`
  - Added centralized env parsing/validation for:
    - `NODE_ENV` profile enforcement (`development|staging|production`)
    - strong non-dev constraints (`JWT_SECRET`, `CORS_ORIGINS`, `DB_SSL`, `DB_SSL_REJECT_UNAUTHORIZED`)
    - strict fail-fast behavior with explicit break-glass override (`ALLOW_INSECURE_NON_DEV`)
  - Added non-dev operational warnings (`TRUST_PROXY`, localhost origins in CORS).
- `packages/server/index.js`
  - Wired server runtime to validated config (`getEnvConfig()`).
  - Replaced direct `process.env` usage for CORS/env-sensitive branches.
- `packages/server/config/db.js`
  - Wired DB connection to validated env (`dbPort`, TLS policy).
- `packages/server/middleware/errorMiddleware.js`
  - Suppresses internal 500 error detail outside development.
- `.env.example`
  - Documented allowed `NODE_ENV` values and `ALLOW_INSECURE_NON_DEV`.

### Verified (Environment Hardening Pass)
- Syntax checks passed:
  - `node --check packages/server/config/env.js`
  - `node --check packages/server/index.js`
  - `node --check packages/server/config/db.js`
  - `node --check packages/server/middleware/errorMiddleware.js`
- Runtime boot check:
  - `npm -w @wsm/server run start` reached listening state (command timeout expected due long-running server process).

### Changed (Payment/Accounting Invariants Pass)
- `packages/server/services/sales.service.js`
  - Added payment normalization and validation helpers for invoice flows:
    - invalid payment amount/method => explicit 400 error
    - overpayment rejected (`PAYMENTS_EXCEED_TOTAL`)
  - `createInvoice(orderId, ...)`:
    - derives `payment_status` from effective payments (`pending|partial|paid`)
    - no longer hardcodes invoice/order as `paid`
    - writes payment trace to `transactions` (`type='sale'`)
    - marks order `completed` only when payment is fully paid
  - `createManualInvoice(...)`:
    - same payment invariants as order-driven invoice
    - writes payment trace to `transactions`
    - conditionally escalates linked order status to `completed` only when fully paid

### Verified (Payment/Accounting Invariants Pass)
- Syntax checks passed:
  - `node --check packages/server/services/sales.service.js`
  - `node --check packages/server/controllers/salesController.js`
- Runtime boot check:
  - `npm -w @wsm/server run start` reached listening state (command timeout expected due long-running server process).

### Changed (P1.1 Client Return Approval Flow)
- `packages/server/services/warranties.service.js`
  - Added transactional `approveReturn(returnId, actorUserId)` with idempotency guards.
  - Added domain error model for predictable controller mapping.
  - Approval flow now executes atomically:
    - lock return + items (`FOR UPDATE`)
    - stock impact by item condition (`inventory` upsert + `inventory_movements`)
    - auto-generate linked credit note (`credit_notes`)
    - accounting trace in `transactions`
    - client current account balance adjustment
    - final status update to `approved`
- `packages/server/controllers/warrantiesController.js`
  - Replaced placeholder approve logic with service orchestration.
  - Added precise HTTP mapping by domain error (`not_found`, `already_approved`, `invalid_state`, etc.).
  - Added audit trace for `APPROVE_CLIENT_RETURN`.

### Verified (P1.1 Client Return Approval Flow)
- Syntax checks passed:
  - `node --check packages/server/services/warranties.service.js`
  - `node --check packages/server/controllers/warrantiesController.js`
- Runtime boot check:
  - `npm -w @wsm/server run start` reached listening state (command timeout expected due long-running server process).

### Changed (P1.2 Order State Machine)
- `packages/server/services/sales.service.js`
  - Added explicit order transition matrix with backend enforcement.
  - Added compatibility aliases for legacy statuses:
    - `confirmed` -> `picking`
    - `paid` -> `packed`
  - Added guarded transition API (`transitionOrderStatus`).
  - Added transition guards in:
    - `dispatchOrder`
    - `deliverOrder`
- `packages/server/controllers/salesController.js`
  - Switched `updateOrderStatus` to transition-aware backend flow.
  - Added explicit HTTP mapping for invalid transitions (`409`) and not found (`404`).

### Verified (P1.2 Order State Machine)
- Syntax checks passed:
  - `node --check packages/server/services/sales.service.js`
  - `node --check packages/server/controllers/salesController.js`
- Runtime boot check:
  - `npm -w @wsm/server run start` reached listening state (command timeout expected due long-running server process).

### Changed (P1.3 Concurrency-Safe Numbering)
- `packages/server/utils/documentSequence.js`
  - Added transactional sequence allocator (`nextDocumentSequence`) using row-level lock (`FOR UPDATE`).
- `packages/server/migrations/002_create_document_sequences.sql`
  - Added durable sequence store table (`document_sequences`).
- `packages/server/services/sales.service.js`
  - Invoice numbering migrated from `MAX+1` to transactional sequence scope (`invoice:{type}:{pos}`).
- `packages/server/controllers/procurementController.js`
  - PO/reception/supplier-return numbering migrated to transactional sequence scopes.
- `packages/server/services/warranties.service.js`
  - Credit note numbering in return approval migrated to transactional sequence scope.
- `packages/server/controllers/warrantiesController.js`
  - Manual credit note creation moved to explicit transaction + sequence allocator.
  - Added audit trace (`CREATE_CREDIT_NOTE`) for manual note creation.
- `packages/server/config/initDb.js`
  - Added `document_sequences` to required runtime table assertions.

### Verified (P1.3 Concurrency-Safe Numbering)
- Syntax checks passed:
  - `node --check packages/server/utils/documentSequence.js`
  - `node --check packages/server/services/sales.service.js`
  - `node --check packages/server/controllers/procurementController.js`
  - `node --check packages/server/services/warranties.service.js`
  - `node --check packages/server/controllers/warrantiesController.js`
  - `node --check packages/server/config/initDb.js`
- Runtime boot check:
  - `npm -w @wsm/server run start`
  - migration `002_create_document_sequences.sql` executed successfully.

### Changed (P1.4 Dynamic SQL Surface Hardening)
- `packages/server/services/sales.service.js`
  - Added strict allowlist sanitizer for orders sorting column.
  - `getOrders` no longer trusts raw `options.orderBy` interpolation.

### Verified (P1.4 Dynamic SQL Surface Hardening)
- Syntax check passed:
  - `node --check packages/server/services/sales.service.js`
- Runtime boot check:
  - `npm -w @wsm/server run start` reached listening state (command timeout expected due long-running server process).

### Changed (P1.5 Fiscal/Company Config Decoupling)
- `packages/server/controllers/settingsController.js`
  - Added shared mapper for company settings payloads.
  - Added `operation` fields in response and update flow:
    - `tax_rate`
    - `default_currency`
  - Added authenticated read-only profile handler for non-admin roles.
  - Update flow now preserves previous tax/currency when `operation` is omitted.
- `packages/server/routes/settingsRoutes.js`
  - Added `GET /api/settings/company/public` (authenticated, no admin role required).
- `packages/server/middleware/validationMiddleware.js`
  - Extended `companySettingsUpdate` schema with:
    - `operation.tax_rate`
    - `operation.default_currency`
- `packages/client/src/types/index.ts`
  - Extended `CompanySettings` with `operation` block.
- `packages/client/src/services/api.ts`
  - Added `api.getCompanyPublicProfile()`.
- `packages/client/src/lib/companySettings.ts`
  - Added centralized helper for:
    - default/fallback company settings
    - safe fetch with fallback to admin endpoint/defaults
    - tax/address/company-name formatting helpers
- `packages/client/src/pages/Invoices.tsx`
  - Replaced hardcoded CUIT/razon social/address/tax label in previews and print templates.
  - Manual invoice VAT default now derives from company settings tax rate.
- `packages/client/src/pages/POS.tsx`
  - Replaced hardcoded tax rate (`0.21`) with settings-backed `operation.tax_rate`.
  - Invoice creation lines now use dynamic VAT rate.
  - Replaced hardcoded legal/company print header fields with settings-backed values.
- `packages/client/src/pages/Orders.tsx`
  - Replaced hardcoded emitter identity in print template with settings-backed values.
  - Extended data load path to include company settings safe-fetch.
- `packages/client/src/pages/Settings.tsx`
  - System tab now derives default tax/currency from company settings.
  - Save System now persists tax/currency via `updateCompanySettings`.

### Verified (P1.5 Fiscal/Company Config Decoupling)
- Backend syntax checks passed:
  - `node --check packages/server/controllers/settingsController.js`
  - `node --check packages/server/routes/settingsRoutes.js`
  - `node --check packages/server/middleware/validationMiddleware.js`
- Frontend lint passed on touched files:
  - `npm -w @wsm/client exec eslint src/pages/Invoices.tsx src/pages/POS.tsx src/pages/Orders.tsx src/pages/Settings.tsx src/lib/companySettings.ts src/services/api.ts src/types/index.ts`
- Frontend typecheck passed:
  - `npm -w @wsm/client exec -- tsc --noEmit`

### Changed (P2.1 Contrast/Accessibility Pass - Receptions)
- `packages/client/src/pages/Receptions.tsx`
  - Increased table readability and contrast:
    - standardized high-contrast table header/body classes.
    - strengthened status badges (foreground/background/ring contrast).
  - Improved interaction accessibility:
    - added `focus-visible` ring styles on tabs, filters, and row action buttons.
  - Improved dense data legibility:
    - stronger font weight on key cells and progress labels.

### Verified (P2.1 Contrast/Accessibility Pass - Receptions)
- Frontend lint run over touched files:
  - `npm -w @wsm/client exec eslint src/pages/Receptions.tsx src/pages/Invoices.tsx src/pages/POS.tsx src/pages/Orders.tsx src/pages/Settings.tsx src/lib/companySettings.ts src/services/api.ts src/types/index.ts`
  - Result: no errors, 1 non-blocking warning (`react-hooks/exhaustive-deps` in `Receptions.tsx`).
- Frontend typecheck passed:
  - `npm -w @wsm/client exec -- tsc --noEmit`

### Changed (P2.6 Frontend Credential Hardening)
- `packages/client/src/lib/passwordPolicy.ts`
  - Added shared strong-password policy constants and regex aligned with backend:
    - length `8..128`
    - requires uppercase, lowercase, number, and symbol
  - Added reusable policy text for UI hint/validation title.
- `packages/client/src/components/users/UserForm.tsx`
  - Password input now enforces client-side policy with:
    - `minLength`, `maxLength`
    - `pattern`
    - `title` with policy details
    - helper text shown below input
  - Keeps create/edit behavior (password optional on edit).

### Verified (P2.6 Frontend Credential Hardening)
- Frontend lint passed on touched files:
  - `npm -w @wsm/client exec eslint src/components/users/UserForm.tsx src/lib/passwordPolicy.ts`
- Frontend typecheck passed:
  - `npm -w @wsm/client exec -- tsc --noEmit`
- Frontend build passed:
  - `npm -w @wsm/client run build`

### Verified (P2.6 Backend Smoke Re-run)
- Staging smoke checks re-executed successfully after rate-limit tuning:
  - `npm -w @wsm/server run smoke:rbac` -> PASS
  - `npm -w @wsm/server run smoke:integrity` -> PASS
- Full integrity path with optional flows enabled -> PASS:
  - `SMOKE_MUTATION=1`
  - `SMOKE_RECEPTION_FLOW=1`
  - `SMOKE_CASH_FLOW=1`
  - `SMOKE_SUPPLIER_ID=85714990-fe53-47a0-9121-2be0a331fdcc`
  - `SMOKE_PRODUCT_ID=9af2b078-6ddb-4305-99e0-eb417ff72db9`
  - `SMOKE_CASH_REGISTER_ID=00000000-0000-0000-0000-000000000001`

### Changed (P2.6 UI Language Consistency - Spanish AR)
- `packages/client/src/components/users/UserForm.tsx`
  - Replaced `Manager` role label with `Gerencia`.
  - Normalized email label wording to `Correo electronico`.
- `packages/client/src/components/ui/dialog.tsx`
  - Translated screen-reader close label from `Close` to `Cerrar`.
- `packages/client/src/pages/Clients.tsx`
  - Search placeholder and form labels normalized from `email`/`Email` to `correo`/`Correo electronico`.
- `packages/client/src/pages/Suppliers.tsx`
  - Replaced `Email` labels/action text with `Correo electronico` / `Correo`.
- `packages/client/src/pages/Settings.tsx`
  - Replaced user/company `Email` labels and table header with `Correo electronico`.

### Verified (P2.6 UI Language Consistency - Spanish AR)
- Frontend lint passed on touched files:
  - `npm -w @wsm/client exec eslint src/components/users/UserForm.tsx src/components/ui/dialog.tsx src/pages/Clients.tsx src/pages/Suppliers.tsx src/pages/Settings.tsx`
- Frontend typecheck passed:
  - `npm -w @wsm/client exec -- tsc --noEmit`
- Frontend build passed:
  - `npm -w @wsm/client run build`
